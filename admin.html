<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registration Data</title>
  <style>
    /* Splash screen */
    #splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
      visibility: visible;
      transition: visibility 0s linear 0.5s, opacity 0.5s linear;
      opacity: 1;
    }
    #splash-screen.hidden {
      visibility: hidden;
      opacity: 0;
    }
    #splash-screen img {
      width: 150px; /* Logo size */
      margin-bottom: 20px;
    }
    #splash-screen p {
      font-family: Arial, sans-serif;
      font-size: 18px;
      color: #333;
    }

    /* Logo */
    #logo {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    #logo img {
      max-width: 150px;
      height: auto;
    }

    /* Table design */
    .table-container {
      max-height: 400px; /* Fixed height */
      overflow-y: auto; /* Vertical scrolling */
      display: block; /* Make table a block to enable scrolling */
      margin: 20px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      background-color: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
      font-family: Arial, sans-serif;
      min-width: 100px; /* Minimum cell width */
    }
    th {
      background-color: #939393;
      color: white;
      cursor: pointer; /* Change cursor on hover */
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    /* Button */
    button {
      padding: 10px 20px;
      background-color: #939393;
      color: white;
      border: none;
      cursor: pointer;
      display: inline-block; /* Inline block to align with search */
      font-family: Arial, sans-serif;
      border-radius: 5px;
      transition: background-color 0.3s ease;
      margin-right: 10px; /* Space between button and search */
    }
    button:hover {
      background-color: #45a049;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 10px;
      background-color: #333333;
      color: white;
      font-family: Arial, sans-serif;
      position: fixed;
      width: 100%;
      bottom: 0;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      table, th, td {
        font-size: 14px;
      }
    }

    /* Search box design */
    #search-wrapper {
      display: flex;
      justify-content: flex-start; /* Align to left */
      margin: 20px 0;
      align-items: center; /* Align items vertically */
    }
    #search-container {
      display: flex;
      align-items: center; /* Vertical alignment */
      border: 1px solid #ddd;
      border-radius: 20px; /* Rounded corners */
      background-color: #f9f9f9; /* Background color */
      overflow: hidden; /* Hide excess edges */
    }
    #column-select, #search-input {
      padding: 10px;
      font-family: Arial, sans-serif;
      border: none; /* Remove border */
      outline: none; /* Remove border on focus */
      transition: border-color 0.3s;
    }
    #column-select {
      background-color: #f9f9f9; /* Background color for select */
      border-radius: 20px 0 0 20px; /* Rounded corners */
    }
    #search-input {
      width: 200px; /* Larger width for search box */
      border-radius: 0 20px 20px 0; /* Rounded corners */
    }
    #search-input:focus, #column-select:focus {
      border-color: #939393; /* Border color on focus */
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.5); /* Add shadow */
    }

    /* Row count design */
    #row-count {
      margin: 20px 0;
      padding: 5px 10px; /* Smaller padding */
      background-color: #e7f3fe; /* Light blue background */
      border: 1px solid #2196F3; /* Blue border */
      border-radius: 5px; /* Rounded corners */
      text-align: center; /* Centered text */
      font-family: Arial, sans-serif;
      color: #0d47a1; /* Dark blue text */
      width: fit-content; /* Fit to content */
      position: absolute; /* Position absolute */
      right: 20px; /* Align to right */
      top: 70px; /* Position from top */
    }
  </style>
</head>
<body>

  <!-- Splash screen -->
  <div id="splash-screen">
    <img src="logo.png" alt="Logo">
    <p>Loading...</p>
  </div>

  <!-- Logo -->
  <div id="logo">
    <img src="logo.png" alt="Logo">
  </div>

  <!-- Search box -->
  <div id="search-wrapper">
    <div id="search-container">
      <select id="column-select">
        <option value="all">All Columns</option>
        <option value="1">Sequence</option>
        <!-- Column options will be added here -->
      </select>
      <input type="text" id="search-input" placeholder="Search in data...">
      <span id="search-icon">ğŸ”</span>
    </div>
    <button onclick="exportToCSV()">Download</button> <!-- Align button with search -->
  </div>

  <!-- Row count display -->
  <div id="row-count">Total Rows: 0</div> <!-- Total rows count -->

  <!-- Title and table -->
  <div class="table-container">
    <table id="data-table">
      <thead>
        <tr id="table-headers">
          <th>Sequence</th> <!-- Sequence column -->
          <!-- Column headers will be added here -->
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- Data will be added here -->
      </tbody>
    </table>
  </div>

  <!-- Footer -->
  <footer>
    All rights reserved to IllustraV
  </footer>
<script>
    const sessionKey = "admin-session-12345"; // Ù†ÙØ³ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ±ÙŠØ¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„

    window.onload = function() {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø¯Ø®ÙˆÙ„Ù‡
        if (localStorage.getItem("ADMIN-LOGIN_SESSION") !== sessionKey) {
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø¯Ø®ÙˆÙ„Ù‡
            window.location.href = "admin-login"; // Ø§Ø³ØªØ¨Ø¯Ù„ admin-login Ø¨Ø§Ø³Ù… Ù…Ù„Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        } else {
            // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            document.getElementById('splash-screen').classList.remove('hidden');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(function() {
                document.getElementById('splash-screen').classList.add('hidden');
                // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ø¹Ø¯ Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†
                setTimeout(logout, 120000); // 120000 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© = 2 Ø¯Ù‚ÙŠÙ‚Ø©
            }, 4000); // Ø¥Ø®ÙØ§Ø¡ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
        }
    };

    function logout() {
        // Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        localStorage.removeItem("ADMIN-LOGIN_SESSION");
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        window.location.href = "admin-login"; // Ø§Ø³ØªØ¨Ø¯Ù„ admin-login Ø¨Ø§Ø³Ù… Ù…Ù„Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    }
</script>

  <script>

    // Fetch data from Google Apps Script
    fetch('https://script.google.com/macros/s/AKfycbwxuE5TMofwBHqCmF36a_HRXDQhnEhfaXSnZrLLHuxUnPjDT1CGEKLskezrgZNSxMHL/exec')
      .then(response => response.json())
      .then(data => {
        // Display data in the table
        const headers = data[0]; // Headers
        const rows = data.slice(1); // Data rows

        // Add headers to the table
        const headersRow = document.getElementById('table-headers');
        headers.forEach((header, index) => {
          const th = document.createElement('th');
          th.textContent = header;
          th.onclick = () => sortTable(index + 1); // Adjust index for sorting
          headersRow.appendChild(th);
          
          // Add column options
          const columnSelect = document.getElementById('column-select');
          const option = document.createElement('option');
          option.value = index + 2; // Set option value to column index + 1
          option.textContent = header; // Option text
          columnSelect.appendChild(option);
        });

        // Add data to the table
        const tableBody = document.getElementById('table-body');
        rows.forEach((row, index) => {
          const tr = document.createElement('tr');
          
          // Add sequence number
          const tdIndex = document.createElement('td');
          tdIndex.textContent = index + 1; // Add sequence number
          tr.appendChild(tdIndex);

          row.forEach(cell => {
            const td = document.createElement('td');
            td.textContent = cell;
            tr.appendChild(td);
          });
          tableBody.appendChild(tr);
        });

        // Update total row count
        document.getElementById('row-count').textContent = `Total Rows: ${rows.length}`;
      });

    // Search function
    document.getElementById('search-input').addEventListener('input', function() {
      const query = this.value.toLowerCase();
      const selectedColumn = document.getElementById('column-select').value;
      const tableBody = document.getElementById('table-body');
      const rows = Array.from(tableBody.getElementsByTagName('tr'));

      rows.forEach(row => {
        const cells = Array.from(row.getElementsByTagName('td'));
        const shouldShow = selectedColumn === 'all'
          ? cells.some(cell => cell.textContent.toLowerCase().includes(query))
          : cells[selectedColumn - 1].textContent.toLowerCase().includes(query);
        row.style.display = shouldShow ? '' : 'none';
      });
    });

    // Sorting function
    function sortTable(columnIndex) {
      const tableBody = document.getElementById('table-body');
      const rows = Array.from(tableBody.getElementsByTagName('tr'));

      rows.sort((a, b) => {
        const aText = a.getElementsByTagName('td')[columnIndex - 1].textContent;
        const bText = b.getElementsByTagName('td')[columnIndex - 1].textContent;

        return aText.localeCompare(bText);
      });

      // Remove current rows
      while (tableBody.firstChild) {
        tableBody.removeChild(tableBody.firstChild);
      }

      // Append sorted rows
      rows.forEach(row => tableBody.appendChild(row));
    }

// Export to CSV with UTF-8 encoding
function exportToCSV() {
  const rows = Array.from(document.querySelectorAll('#data-table tr'));
  const csvContent = rows.map(row => {
    const cols = Array.from(row.querySelectorAll('td, th'));
    return cols.map(col => `"${col.textContent.replace(/"/g, '""')}"`).join(',');
  }).join('\n');

  const blob = new Blob([`\uFEFF${csvContent}`], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.setAttribute('download', 'data.csv');
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

  </script>
</body>
</html>
